<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estados del agua – Modelo molecular 3D</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f4f4;
}
#panel {
  background: white;
  padding: 10px;
  text-align: center;
}
#scene {
  width: 600px;
  height: 400px;
  margin: auto;
  border: 2px solid #ccc;
}
</style>
</head>

<body>

<div id="panel">
  Temperatura:
  <input type="range" id="temp" min="-20" max="120" value="20">
  <span id="t">20</span> °C
  <br>
  Estado: <strong><span id="estado">Líquido</span></strong>
</div>

<div id="scene"></div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<script>
const container = document.getElementById("scene");

// ESCENA
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf0f0f0);

// CÁMARA
const camera = new THREE.PerspectiveCamera(75, 600/400, 0.1, 100);
camera.position.z = 12;

// RENDER
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(600, 400);
container.appendChild(renderer.domElement);

// LUZ
scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const light = new THREE.PointLight(0xffffff, 0.8);
light.position.set(10,10,10);
scene.add(light);

// MOLÉCULAS (esferas = moléculas de agua)
const molecules = [];
const N = 30;
const limits = 4;

// CREAR MOLÉCULAS (NO SE DESTRUYEN)
for (let i=0; i<N; i++) {
  const geo = new THREE.SphereGeometry(0.3, 16, 16);
  const mat = new THREE.MeshStandardMaterial({color: 0x0087C8});
  const m = new THREE.Mesh(geo, mat);

  m.position.set(
    (Math.random()-0.5)*3,
    (Math.random()-0.5)*3,
    (Math.random()-0.5)*3
  );

  m.velocity = new THREE.Vector3();
  m.home = m.position.clone(); // posición sólida

  molecules.push(m);
  scene.add(m);
}

// ESTADO
let estado = "liquido";

function actualizarEstado() {
  const T = temp.value;
  document.getElementById("t").innerText = T;

  if (T < 0) estado = "solido";
  else if (T >= 100) estado = "gaseoso";
  else estado = "liquido";

  document.getElementById("estado").innerText =
    estado.charAt(0).toUpperCase() + estado.slice(1);
}

temp.oninput = actualizarEstado;

// ANIMACIÓN
function animate() {
  requestAnimationFrame(animate);

  molecules.forEach(m => {

    if (estado === "solido") {
      // vibración alrededor del punto fijo
      m.position.lerp(m.home, 0.1);
      m.position.x += (Math.random()-0.5)*0.02;
      m.position.y += (Math.random()-0.5)*0.02;
      m.position.z += (Math.random()-0.5)*0.02;
    }

    if (estado === "liquido") {
      // movimiento lento, cercano
      m.velocity.add(new THREE.Vector3(
        (Math.random()-0.5)*0.01,
        (Math.random()-0.5)*0.01,
        (Math.random()-0.5)*0.01
      ));
      m.position.add(m.velocity);
      m.velocity.multiplyScalar(0.9);
    }

    if (estado === "gaseoso") {
      // movimiento rápido y libre
      m.velocity.add(new THREE.Vector3(
        (Math.random()-0.5)*0.05,
        (Math.random()-0.5)*0.05,
        (Math.random()-0.5)*0.05
      ));
      m.position.add(m.velocity);
    }

    // límites
    ["x","y","z"].forEach(a=>{
      if (Math.abs(m.position[a]) > limits) m.velocity[a] *= -1;
    });
  });

  renderer.render(scene, camera);
}

actualizarEstado();
animate();
</script>

</body>
</html>
