<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estados de la materia – Modelo molecular</title>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f7f7f7;
  padding: 20px;
}

h1 { color: #5A2382; }
h2 { color: #0087C8; }

button {
  padding: 10px 15px;
  margin: 5px;
  background: #E6500F;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:disabled {
  background: #aaa;
}

input[type=range] {
  width: 300px;
}

.box {
  background: white;
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
}
</style>
</head>

<body>

<h1>Estados de la materia</h1>

<div class="box">
<h2>Consigna</h2>
<p>
Mové la temperatura y observá el modelo molecular.
<br><br>
<b>• ¿Qué tan juntas están las partículas?</b><br>
<b>• ¿Cómo cambia su movimiento?</b><br>
<br>
Recordá: <i>esto es un modelo, no una imagen real</i>.
</p>
</div>

<div class="box">
<p>Temperatura: <span id="tempValor">20</span> °C</p>
<input type="range" min="-10" max="120" value="20" id="temp" oninput="actualizarTemp()">
<br><br>
<button id="btnSimular" onclick="simular()" disabled>Cargando simulador...</button>
</div>

<div class="box">
<strong>Estado:</strong> <span id="estadoTexto">Líquido</span>
</div>

<div class="box">
<div id="grafico"></div>
</div>

<script>
let pyodide = null;

async function iniciar() {
  pyodide = await loadPyodide();
  await pyodide.loadPackage("matplotlib");

  const btn = document.getElementById("btnSimular");
  btn.disabled = false;
  btn.innerText = "Simular";
}

iniciar();

function actualizarTemp() {
  const t = document.getElementById("temp").value;
  document.getElementById("tempValor").innerText = t;

  let estado = "Líquido";
  if (t < 0) estado = "Sólido";
  if (t >= 100) estado = "Gaseoso";

  document.getElementById("estadoTexto").innerText = estado;
}

async function simular() {
  if (!pyodide) {
    alert("El simulador todavía se está cargando");
    return;
  }

  const t = document.getElementById("temp").value;

  let estado = "liquido";
  if (t < 0) estado = "solido";
  if (t >= 100) estado = "gaseoso";

  const codigo = `
import matplotlib
matplotlib.use("module://matplotlib_pyodide.html5_canvas")

import matplotlib.pyplot as plt
import random

N = 36
trayectorias_x = []
trayectorias_y = []

if "${estado}" == "solido":
    for i in range(6):
        for j in range(6):
            trayectorias_x.append([i*0.12 + 0.15])
            trayectorias_y.append([j*0.12 + 0.15])
    pasos = 10
    movimiento = 0.005

elif "${estado}" == "liquido":
    for _ in range(N):
        trayectorias_x.append([random.uniform(0.3,0.7)])
        trayectorias_y.append([random.uniform(0.3,0.7)])
    pasos = 25
    movimiento = 0.03

else:
    for _ in range(N):
        trayectorias_x.append([random.uniform(0,1)])
        trayectorias_y.append([random.uniform(0,1)])
    pasos = 40
    movimiento = 0.08

for _ in range(pasos):
    for i in range(N):
        x = trayectorias_x[i][-1] + random.uniform(-movimiento, movimiento)
        y = trayectorias_y[i][-1] + random.uniform(-movimiento, movimiento)
        x = min(max(x,0),1)
        y = min(max(y,0),1)
        trayectorias_x[i].append(x)
        trayectorias_y[i].append(y)

plt.figure(figsize=(5,5))

for i in range(N):
    plt.plot(trayectorias_x[i], trayectorias_y[i], alpha=0.6)
    plt.scatter(trayectorias_x[i][-1], trayectorias_y[i][-1])

plt.title("Modelo molecular – Estado: ${estado}")
plt.xlim(0,1)
plt.ylim(0,1)
plt.axis("off")
plt.show()
  `;

  document.getElementById("grafico").innerHTML = "";
  await pyodide.runPythonAsync(codigo);
}
</script>

</body>
</html>
