<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estados de la materia – Modelo molecular</title>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f7f7f7;
  padding: 20px;
}

h1 { color: #5A2382; }
h2 { color: #0087C8; }

button {
  padding: 10px 15px;
  margin: 5px;
  background: #E6500F;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:disabled {
  background: #aaa;
}

input[type=range] {
  width: 300px;
}

.box {
  background: white;
  padding: 15px;
  border-radius: 8px;
  margin-top: 15px;
}
</style>
</head>

<body>

<h1>Estados de la materia</h1>

<div class="box">
<h2>Consigna</h2>
<p>
Mové la temperatura y observá el modelo molecular.
<br><br>
<b>• ¿Qué tan juntas están las partículas?</b><br>
<b>• ¿Cómo cambia su movimiento?</b><br><br>
<i>Este es un modelo científico, no una imagen real.</i>
</p>
</div>

<div class="box">
<p>Temperatura: <span id="tempValor">20</span> °C</p>
<input type="range" min="-10" max="120" value="20" id="temp" oninput="actualizarTemp()">
<br><br>
<button id="btnSimular" disabled onclick="simular()">Cargando simulador...</button>
</div>

<div class="box">
<strong>Estado:</strong> <span id="estadoTexto">Líquido</span>
</div>

<div class="box">
<div id="grafico"></div>
</div>

<script>
let pyodide = null;

async function iniciar() {
  pyodide = await loadPyodide();
  await pyodide.loadPackage(["matplotlib", "numpy"]);

  const btn = document.getElementById("btnSimular");
  btn.disabled = false;
  btn.innerText = "Simular";
}

iniciar();

function actualizarTemp() {
  const t = document.getElementById("temp").value;
  document.getElementById("tempValor").innerText = t;

  let estado = "Líquido";
  if (t < 0) estado = "Sólido";
  if (t >= 100) estado = "Gaseoso";

  document.getElementById("estadoTexto").innerText = estado;
}

async function simular() {
  if (!pyodide) {
    alert("El simulador todavía se está cargando");
    return;
  }

  const t = document.getElementById("temp").value;

  let estado = "liquido";
  if (t < 0) estado = "solido";
  if (t >= 100) estado = "gaseoso";

  const codigo = `
import matplotlib.pyplot as plt
import random

N = 36
tray_x = []
tray_y = []

if "${estado}" == "solido":
    for i in range(6):
        for j in range(6):
            tray_x.append([i*0.12 + 0.15])
            tray_y.append([j*0.12 + 0.15])
    pasos = 10
    mov = 0.004

elif "${estado}" == "liquido":
    for _ in range(N):
        tray_x.append([random.uniform(0.3,0.7)])
        tray_y.append([random.uniform(0.3,0.7)])
    pasos = 25
    mov = 0.03

else:
    for _ in range(N):
        tray_x.append([random.uniform(0,1)])
        tray_y.append([random.uniform(0,1)])
    pasos = 40
    mov = 0.08

for _ in range(pasos):
    for i in range(N):
        x = tray_x[i][-1] + random.uniform(-mov, mov)
        y = tray_y[i][-1] + random.uniform(-mov, mov)
        tray_x[i].append(min(max(x,0),1))
        tray_y[i].append(min(max(y,0),1))

plt.figure(figsize=(5,5))
for i in range(N):
    plt.plot(tray_x[i], tray_y[i], alpha=0.6)
    plt.scatter(tray_x[i][-1], tray_y[i][-1])

plt.title("Modelo molecular – Estado: ${estado}")
plt.xlim(0,1)
plt.ylim(0,1)
plt.axis("off")
plt.show()
  `;

  document.getElementById("grafico").innerHTML = "";
  await pyodide.runPythonAsync(codigo);
}
</script>

</body>
</html>
