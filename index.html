<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estados de la materia – Modelo molecular 3D</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f7f7f7;
  }
  #panel {
    padding: 10px;
    background: #ffffff;
    text-align: center;
  }
  #scene {
    width: 600px;
    height: 400px;
    margin: auto;
    border: 2px solid #ccc;
  }
</style>
</head>

<body>

<div id="panel">
  Temperatura:
  <span id="tempValor">20</span> °C
  <input type="range" min="-10" max="120" value="20" id="temp">
  <br>
  Estado: <strong><span id="estadoTexto">Líquido</span></strong>
</div>

<div id="scene"></div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<script>
const container = document.getElementById("scene");

// ESCENA
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf0f0f0);

// CÁMARA
const camera = new THREE.PerspectiveCamera(75, 600/400, 0.1, 1000);
camera.position.z = 10;

// RENDER
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(600, 400);
container.appendChild(renderer.domElement);

// LUZ
const light = new THREE.PointLight(0xffffff, 1);
light.position.set(10, 10, 10);
scene.add(light);

// MOLÉCULAS
let molecules = [];
const boxSize = 4;

function crearMoleculas(estado) {
  molecules.forEach(m => scene.remove(m.mesh));
  molecules = [];

  let velocidad = 0.1;
  let dispersion = 2;

  if (estado === "solido") {
    velocidad = 0.02;
    dispersion = 1.5;
  }
  if (estado === "liquido") {
    velocidad = 0.15;
    dispersion = 2.5;
  }
  if (estado === "gaseoso") {
    velocidad = 0.6;
    dispersion = 4;
  }

  for (let i = 0; i < 40; i++) {
    const geometry = new THREE.SphereGeometry(0.25, 16, 16);
    const material = new THREE.MeshStandardMaterial({ color: 0x0087C8 });
    const sphere = new THREE.Mesh(geometry, material);

    sphere.position.set(
      (Math.random() - 0.5) * dispersion,
      (Math.random() - 0.5) * dispersion,
      (Math.random() - 0.5) * dispersion
    );

    sphere.velocity = new THREE.Vector3(
      (Math.random() - 0.5) * velocidad,
      (Math.random() - 0.5) * velocidad,
      (Math.random() - 0.5) * velocidad
    );

    molecules.push({ mesh: sphere });
    scene.add(sphere);
  }
}

// TEMPERATURA
function actualizar() {
  const t = document.getElementById("temp").value;
  document.getElementById("tempValor").innerText = t;

  let estado = "liquido";
  if (t < 0) estado = "solido";
  if (t >= 100) estado = "gaseoso";

  document.getElementById("estadoTexto").innerText =
    estado.charAt(0).toUpperCase() + estado.slice(1);

  crearMoleculas(estado);
}

document.getElementById("temp").oninput = actualizar;

// ANIMACIÓN
function animate() {
  requestAnimationFrame(animate);

  molecules.forEach(m => {
    const p = m.mesh;
    p.position.add(p.velocity);

    ["x","y","z"].forEach(axis => {
      if (Math.abs(p.position[axis]) > boxSize) {
        p.velocity[axis] *= -1;
      }
    });
  });

  renderer.render(scene, camera);
}

actualizar();
animate();
</script>

</body>
</html>
